# lsof

## 介绍

         lsof（list open files）是一个列出当前系统打开文件的工具。在linux环境下，任何事物都以文件的形式存在，通过文件不仅仅可以访问常规数据，还可以访问网络连接和硬件。所以如传输控制协议 (TCP) 和用户数据报协议 (UDP) 套接字等，系统在后台都为该应用程序分配了一个文件描述符，无论这个文件的本质如何，该文件描述符为应用程序与基础操作系统之间的交互提供了通用接口。因为应用程序打开文件的描述符列表提供了大量关于这个应用程序本身的信息，因此通过lsof工具能够查看这个列表对系统监测以及排错将是很有帮助的。
    
## 参数介绍

    -a 列出打开文件存在的进程(逻辑与)
 
    -c <进程名> 列出指定进程所打开的文件
     
    -g  列出GID号进程详情
     
    -d <文件号> 列出占用该文件号的进程
     
    +d <目录>  列出目录下被打开的文件
     
    +D <目录>  递归列出目录下被打开的文件
     
    -n <目录>  列出使用NFS的文件
     
    -i <条件>  列出符合条件的进程。（4、6、协议、:端口、 @ip ）
     
    -p <进程号> 列出指定进程号所打开的文件
     
    -u  列出UID号或用户名进程详情
     
    -h 显示帮助信息
     
    -v 显示版本信息

## 使用

1. 看谁正在使用某个文件，也就是说查找某个文件相关的进程

```
lsof /bin/bash
```

2. 递归查看某个目录的文件信息

```
lsof +D /usr/local
```

3. 列出某个用户打开的文件信息

```
lsof -u root或lsof -u 0
```
4. 列出某个程序进程所打开的文件信息
```
lsof -c mysql

-c 选项将会列出所有以mysql这个进程开头的程序的文件，其实你也可以写成 lsof | grep mysql, 但是第一种方法明显比第二种方法要少打几个字符了

lsof -c mysql -c nginx 以mysql或nginx开头的进程打开的文件 （列出多个进程打开的文件信息）

```

5. 列出某个用户或某个进程所打开的文件信息

```
lsof  -u root -c mysql
```

6. 列出除了某个用户外的被打开的文件信息

```
lsof -u ^root

^这个符号在用户名之前，将会把是root用户打开的进程不让显示
```

7. 列出nginx或者mysql用户打开的文件

```
lsof -u mysql -u nginx  （列出多个用户打开的文件信息）

```

8. 通过某个进程号显示该进行打开的文件

```
lsof -p 1124
```

9. 列出多个进程号对应的文件信息

```
lsof -p 1160,1161
```

10. 列出除了某个进程号，其他进程号所打开的文件信息

```
lsofl  -p ^1160
```

11. 列出所有的网络连接

```
lsof -i
```

12. 列出所有tcp 网络连接信息

```
lsof -i tcp
lsof -i udp
```

13. 列出谁在使用某个端口

```
lsof -i :80
```

14. 列出谁在使用某个特定的tcp端口

```
lsof -i tcp:80

lsof -i udp:55
```

15. 列出某个用户的所有活跃的网络端口

```
lsof -a -u root -i
```

16. 所有IPV4 network files

```
lsof -i 4
clsof -i 6
```

16. 列出被进程号为1161的进程所打开的所有IPV4 network files

```
lsof -i 4 -a -p 1161
```
17. 列出目前连接主机peida.linux上端口为：80，3306，6379，9000相关的所有文件信息，且每隔3秒不断的执行lsof指令

```
lsof -i :80,33066379,9000  -r  3
```
16. 某个用户组所打开的文件信息

```
lsof -g 0
```